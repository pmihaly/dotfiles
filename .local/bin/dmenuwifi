#!/bin/sh

notify-send -t 3000 "ðŸ“¡ wifi keresÃ©se..."
selected_wifi_ssid="$(
nmcli --terse d wifi |
    cut -d":" -f8,13,11,14 |
    sed "s/:/ | /g" |
    dmenu -i -l 30 |
    cut -d"|" -f1 |
    sed "s/^\s*//g ; s/\s*$//g"
)"

try_to_connect_with_password() {
    # "nmcli d wifi c" always has a 0 return value...
    password="$(dmenu -p "$1 jelszava:" </dev/null)"
    [ -n "$password" ] && nmcli d wifi c "$1" password "$password" && try_to_connect_from_profile "$1"
}

try_to_connect_from_profile() {
    # ..., but nmcli returns 1 when erroring out while trying to use a profile
    notify-send -t 3000 "ðŸ“¡ csatlkakozÃ¡s $1 hÃ¡lÃ³zatra..." && nmcli c up "$1" || try_to_connect_with_password "$1"
}

[ -n "$selected_wifi_ssid" ] && try_to_connect_from_profile "$selected_wifi_ssid"

ping -c3 1.1.1.1 && notify-send -t 3000 "ðŸŒ van internet" || notify-send -t 5000 "â— nincs, vagy lassÃº internet"
