#!/bin/sh

# dmenu "frontend" for qalc
# depends on: dmenu (with initial text patch) and qalc

# multiple expressions can be separated by a semicolon
# you can do further calculations with the result by selecting it, or you can exit with ESC

input="$(dmenu -p "qalc: " -it "$* " < /dev/null)"

[ -n "$input" ] && echo "$input" |                          # only run if user gave something
    sed "s/\s*;\s*/\n/g" |                                  # replace semicolon (with optional whitespace around it) with newline
    qalc -t -c0 |                                           # terse, no color output
    sed -E "/^(>|$)/d ; s/^\s*//g ; s/\s*(and|or)\s*//g" |  # remove unneeded lines, whitespace, 'and' and 'or'
    dmenu -p "answ: " |                                     # each item is the result(s) of each expression
    sed -E "s/[a-zA-Z]\s*(=|≈|>|<|≥|≤)\s*//g" |             # remove variable name and signs for further calculations
    xargs -r -I{} $0 {}                                     # calling this script recursively
